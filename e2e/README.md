# FIndex E2E Tests

End-to-end tests for FIndex using Playwright.

## Prerequisites

- Node.js 18+
- Go 1.23+ (to build the application)
- Make

## Setup

```bash
# From project root, build the application
make build

# Set up test data
cd e2e
./setup.sh

# Install dependencies
npm install

# Install Playwright browsers
npx playwright install chromium
```

## Running Tests

```bash
cd e2e

# Run all tests (headless)
npm test

# Run tests with browser visible
npm run test:headed

# Run tests in debug mode
npm run test:debug

# View test report
npm run report
```

## Test Structure

```
e2e/
├── tests/
│   └── findex.spec.ts    # Main test file
├── testdata/
│   ├── config.yaml       # Test configuration
│   ├── data/             # SQLite database (generated)
│   └── files/            # Test files (generated by setup.sh)
├── playwright.config.ts  # Playwright configuration
├── package.json
└── setup.sh              # Test data setup script
```

## Test Scenarios

### Empty Index State
- Verifies application works with empty database
- Shows index list but no search results
- Browse shows empty directory

### After Indexing
- Files appear after running indexer
- Directory navigation works
- Breadcrumb navigation works

### Search Functionality
- Find files by name
- Partial name matching
- Files in subdirectories
- Exclusion with minus prefix
- Result count display

### Filtering
- Filter by extension (single and multiple)
- Filter by minimum/maximum size
- Filter files only / directories only
- Combine search with filters

### Statistics Page
- Total file count is correct
- File type distribution
- Total storage size
- Largest files list

### UI Elements
- Home link navigation
- Index badges
- Extension badges
- Directory size display
- Footer with version

### Error Handling
- 404 for non-existent index
- Error page navigation options

## Test Data

The `setup.sh` script creates:

```
files/
├── documents/
│   ├── annual_report_2024.pdf
│   ├── meeting_notes.txt
│   ├── project_spec.docx
│   ├── budget_2024.xlsx
│   └── contract_draft.pdf
├── images/
│   ├── vacation/
│   │   ├── beach_sunset.jpg
│   │   ├── mountain_view.jpg
│   │   └── hotel_room.png
│   └── photo_raw.nef
└── videos/
    ├── holiday_2024.mp4 (~5MB)
    └── birthday_party.mkv (~3MB)
```

## CI Integration

For CI environments, set `CI=true`:

```bash
CI=true npm test
```

This enables:
- No server reuse (fresh server per run)
- Retries on failure
- Stricter mode (no `.only()` allowed)
